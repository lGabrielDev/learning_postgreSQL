<h1 align="center"; style="color:">PRIMARY KEY (chave prim√°ria) <img src="https://cdn-icons-png.flaticon.com/512/807/807241.png" width="42px" align="right"></h1> 

## Introduction


Imagine a seguinte table:

| first_name | last_name | gender | date_of_birth | email |
|:--:|:--:|:--:|:--:|:--:|
| Gabriel | Smith | MALE | 09/01/1989 | biel@gmail.com |
| Gabriel | Smith | MALE | 09/01/1989 | bielzin999@gmail.com |



Perceba que temos duas pessoas com o mesmo nome, sobrenome e data de nascimento. Mesmo tendo um e-mail diferente, n√£o conseguimos identificar as rows de forma **UNIQUE**.

A√≠ que entra a **PRIMARY KEY**.

<br>

| passport_number | first_name | last_name | gender | date_of_birth | email |
| :---: |:--:|:--:|:--:|:--:|:--:|
| x4956 | Gabriel | Smith | MALE | 09/01/1989 | biel@gmail.com |
| x4957 | Gabriel | Smith | MALE | 09/01/1989 | bielzin999@gmail.com |


Agora sim, conseguimos identificar uma row de forma **UNIQUE**.

No mundo real, nossos documentos (RG, passport, CPF, Carteira de trabalho, etc...) funcionam como **PRIMARY KEYS**. √â atrav√©s deles que conseguimos nos identificar como pessoas √∫nicas.

N√£o existe dois RGs iguais. Sacou??



Resumindo:

**PRIMARY KEY** -> √â um valor em um campo que identifica um row em uma table.

√â uma boa pr√°tica toda table ter uma **PRIMARY KEY**. Lembrando que pode ter somente uma **PRIMARY KEY** por table. 

<br>
<hr>

## Definindo uma PRIMARY KEY na criaca√ß√£o da table

Normalmente definimos a **PRIMARY KEY** assim que criamos a table.

Geralmente uma column com PRIMARY KEY sempre ter√° apenas dois tipos de datatype:

* `SERIAL`  -> INTEGER + auto_increment
* `BIGSERIAL` -> BIGINT + auto_increment

<br>

Esses dois datatypes s√£o **INTEGER** e tem **auto_increment**. Ou seja... Sempre que inserir um dado na table, esse campo ser√° automaticamente preenchido.

**SERIAL** = INT + auto_increment;

**BIGSERIAL** = BIGINT + auto_increment;

<br>

### Syntax:

```sql
CREATE TABLE IF NOT EXISTS tb_person(
    id BIGSERIAL NOT NULL CONSTRAINT pk_tb_person PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    gender VARCHAR(7) CONSTRAINT check_gender CHECK (gender IN('MALE','FEMALE')) NOT NULL,
    email VARCHAR(100),
    date_of_birty DATE NOT NULL,
    country_of_birty VARCHAR(50) NOT NULL
);
```


Perceba que o campo '**id**' possui o datatype **BIGSERIAL** e a constraint **PRIMARY KEY**.

Como colocamos a constraint direto no campo, o nome dessa constraint ser√° um nome padr√£o que o psql vai dar.


Assim, √© imposs√≠vel ter rows iguais. Com essa column **PRIMARY KEY**, conseguimos fazer com que todas as linhas sejam √∫nicas.


Tecnicamente, a constraint **PRIMARY KEY** √© a jun√ß√£o das constraints **UNIQUE** and **NOT NULL**.

<br>

:pencil2: Descreva a table criada:

```sql
\d tb_person;
```

Perceba que informa o nome da constraint PRIMARY KEY que foi criada:

```sql
"tb_person_pkey" PRIMARY KEY, btree (id)
```
Esse nome "tb_person_pkey" √© o nome da constraint.



<br>


:pencil2: Tente inserir 2 rows iguais:

```sql
INSERT INTO tb_person
    (id,first_name,last_name,gender,email,date_of_birty,country_of_birty)
VALUES
    (1,'Pedro','Albuquerque','MALE','pedro@gmail.com','1996-09-11','Brazil'),
    (1,'Pedro','Albuquerque','MALE','pedro@gmail.com','1996-09-11','Brazil');
```


Vai dar erro. Isso porque na coluna **id** temos a constraint **PRIMARY KEY**, ou seja... S√≥ √© permitido valores **UNIQUE** nessa column.

<br>

:pencil2: Remova a constraint "tb_person_pkey" da column **id**:

```sql
ALTER TABLE tb_person
    DROP CONSTRAINT tb_person_pkey;
```

Pronto, removemos a constriant.

<br>

:pencil2: Tente inserir 2 rows iguais novamente:

```sql
INSERT INTO tb_person
    (id,first_name,last_name,gender,email,date_of_birty,country_of_birty)
VALUES
    (1,'Pedro','Albuquerque','MALE','pedro@gmail.com','1996-09-11','Brazil'),
    (1,'Pedro','Albuquerque','MALE','pedro@gmail.com','1996-09-11','Brazil');
```

Agora sim, conseguimos adicionar rows iguais. 

Viu a import√¢ncia de ter em uma table uma column com a constraint **PRIMARY KEY** ??

Assim, garantimos que n√£o sejam adicionadas rows iguais.

<br>
<hr>


## Dropando uma PRIMARY KEY
Como vimos acima, para dropar uma constraint fazemos assim:

1. Primeiro, descrevemos a table para verificar o nome da constraint:

    ```sql
    \d tb_tal;
    ```

2. Agora √© s√≥ dropar a constraint que n√£o queremos mais:

    ```sql
    ALTER TABLE table_name
    DROP CONSTRAINT constraint_name;
    ```


    Podemos dropar qualquer CONSTRAINT(**PRIMARY KEY**, **CHECK** etc...).

<br>
<hr>


## Definindo uma PRIMARY KEY na criaca√ß√£o da table, e especificando o nome dessa constraint.

Outra forma de adicionar uma constraint seria especificando o nome dessa constraint.

### Syntax:

```sql
CONSTRAINT constraint_name PRIMARY KEY(column);
```

Igual quando queremos adicionar uma constraint em uma table j√° criada. S√≥ que aqui, n√£o utilizamos o `ADD`.


<br>

### Definindo na mesma linha do campo


```sql
CREATE TABLE IF NOT EXISTS tb_person(
    id BIGSERIAL NOT NULL CONSTRAINT nome_da_constraint PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    gender VARCHAR(7) CHECK (gender IN('MALE','FEMALE')) NOT NULL,
    email VARCHAR(100),
    date_of_birty DATE NOT NULL,
    country_of_birty VARCHAR(50) NOT NULL
);
```

```sql
\l
```



<br>
<br>

### Definindo no final

Primeiro criamos os campos e no final informamos nossas constraints.

Seguindo aquela mesma table:

```sql
CREATE TABLE IF NOT EXISTS tb_person(
    id BIGSERIAL NOT NULL,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    gender VARCHAR(7) CHECK (gender IN('MALE','FEMALE')) NOT NULL,
    email VARCHAR(100),
    date_of_birty DATE NOT NULL,
    country_of_birty VARCHAR(50) NOT NULL,
    -- constraints
    CONSTRAINT pk_tb_person PRIMARY KEY (id)
);
```

Perceba que aqui, precisamos especificar qual o campo que vamos atribuir essa constraint.

```sql
\l
```

üí°Sempre escolha o nome das constraints. Fica muito mais f√°cil quando n√≥s definimos o nome. Lembrando tamb√©m, que serve para qualquer constraint(**UNIQUE**,**PRIMARY KEY**, **FOREIGN KEY**, etc...)

<hr>
<br>



## Adicionando uma Constraint em uma table j√° criada
Existem duas formas de adicionar **PRIMARY KEY** em uma table. A primeira, como vimos antes, √© adicionar assim que criamos a table. 

```sql
CREATE TABLE tb_tal (
column_1 BIGSERIAL CONSTRAINT constraint_name PRIMARY KEY,
column_2 data_type,
‚Ä¶
);
```
OU
<br>

```sql
CREATE TABLE tb_tal (
column_1 BIGSERIAL,
column_2 data_type,
-- constraints
CONSTRAINT constraint_name PRIMARY KEY(column_1)
);
```
<br>

Para adicionar uma constraint em uma table j√° criada, fazemos assim:


```sql
ALTER TABLE tb_tal 
ADD CONSTRAINT pk_tb_tal PRIMARY KEY(id);
```


Mesma syntax dos exemplos acima, por√©m colocamos a keyword `ADD` antes.

"Vamos alterar a table, adicionar uma constraint, o nome da constraint √© tal, o tipo da constriant √© **PRIMARY KEY** e dentro colocamos a column que vai receber a constraint."

<br>

:pencil2: Crie uma table simples com apenas 2 campos (**id**, **first_name**) e adicione a constraint PRIMARY KEY depois que a table foi criada.


1. Criando a table sem a **PRIMARY KEY**:

    ```sql
    CREATE TABLE IF NOT EXISTS tb_praticando(
    id BIGSERIAL NOT NULL UNIQUE,
    first_name VARCHAR(50) NOT NULL
    );
    ```

2. Adicionando a constraint **PRIMARY KEY** na table:

    ```sql
    ALTER TABLE tb_praticando 
    ADD CONSTRAINT pk_tb_praticando PRIMARY KEY(id);
    ```

3. Describe the table:

    ```sql
    \d tb_praticando;
    ```
    

    <br>

    :warning: N√£o √© poss√≠vel adicionar a constraint **PRIMARY KEY** se as rows da column n√£o forem √∫nicas. Se tiver linhas duplicadas n√£o ser√° poss√≠vel adicionar a constraint.

    A√≠ voc√™ teria que excluir essas rows duplicadas.


    <br>

    :bulb: Poder√≠amos ter adicionado outro tipo de constraint ao inv√©s da constraint **PRIMARY KEY**. Poderia ser adicionado as constraints **FOREIGN KEY**, **CHECK**, **UNIQUE**, etc...

    <br>

    :pencil2: Adicione uma constraint **UNIQUE** para a **column first_name**:

    ```sql
    ALTER TABLE tb_praticando 
    ADD CONSTRAINT unique_first_name UNIQUE (first_name);
    ```

    "Vamos alterar a table, adicionar uma constraint, o nome da constraint √© tal, o tipo da constriant √© **UNIQUE** e dentro colocamos o campo que vai receber a constraint."

<br>

<!-- Bot√£o para o pr√≥ximo resumo em ordem sequ√™ncial -->
<a href="https://github.com/lGabrielDev/06.postgreSQL/blob/main/2.praticando/19.foreign_key.md"><img alt="√çcone de uma seta apontada para direita, representando um link para a pr√≥xima p√°gina" src="https://cdn-icons-png.flaticon.com/512/8875/8875266.png" width="50px" height="50px" align="right"></a>